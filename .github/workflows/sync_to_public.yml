name: Sync Private to Public

on:
  schedule:
    - cron: "0 7 * * 0"  # Every Sunday at 08:00 CET
  workflow_dispatch:      # Allows manual triggering

permissions:
  contents: write          # Grants write permissions to push changes

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      # Step 1: Re-clone the private repository using the PAT for authentication
      - name: Re-clone the private repository
        run: |
          rm -rf 1BHIF-Pose-Private  # Remove the existing clone if it exists
          git clone https://github.com/lukasWastaken/1BHIF-Pose-Private.git  # Clone the private repository
          cd 1BHIF-Pose-Private
          git remote add public https://github.com/lukasWastaken/1BHIF-Pose.git  # Add the public repository as a remote
        env:
          GIT_ASKPASS: "echo"       # Disable password prompt
          GITHUB_TOKEN: ${{ secrets.PUBLIC_REPO_TOKEN }}  # Use the secret PAT

      # Step 2: Set up Git config
      - name: Set up Git config
        run: |
          git config --global user.name 'lukasWastaken'
          git config --global user.email 'l.leutgeb@students.htl-leonding.ac.at'

      # Step 3: Clean repository and check integrity
      - name: Clean repository and check integrity
        run: |
          git gc --prune=now --aggressive  # Run garbage collection to clean up the repository
          git fsck --full  # Check the repository for any issues

      # Step 4: Push to the public repository
      - name: Push to public repository
        run: |
          git push -u public main -f --no-verify  # Force push changes to the public repository without verification
